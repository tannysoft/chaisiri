!function(t){function e(t,e){this.settings=t,this.dom=e,this.originalValue=null,this.didInsertDefaultText=!1,this.shouldDelayReinit=!1}function i(t){if(!t.url&&!t.callback)throw new Error("Need to set either url: or callback: option for the inline editor to work.")}function n(t){if(""!==t){var e=new Image;e.src=t}}function s(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}function a(t){return void 0===t||null===t?!1:0!==t.length}t.fn.editInPlace=function(s){var a=t.extend({},t.fn.editInPlace.defaults,s);return i(a),n(a.saving_image),this.each(function(){var i=t(this);i.data("editInPlace")||(i.data("editInPlace",!0),new e(a,i).init())})},t.fn.editInPlace.defaults={url:"",bg_over:"#BFE9F3",bg_out:"",hover_class:"",show_buttons:!1,save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',params:"",field_type:"text",default_text:"(Click here to add text)",use_html:!1,textarea_rows:10,textarea_cols:25,select_text:"Choose new value",select_options:"",text_size:null,saving_text:"Saving...",saving_image:"",saving_animation_color:"",value_required:!1,element_id:"element_id",update_value:"update_value",original_value:"original_value",original_html:"original_html",save_if_nothing_changed:!1,on_blur:"save",cancel:"",callback:null,callback_skip_dom_reset:!1,success:null,error:null,error_sink:function(t,e){alert(e)},preinit:null,postclose:null,delegate:null};t.extend(e.prototype,{init:function(){this.setDefaultTextIfNeccessary(),this.connectOpeningEvents()},reinit:function(){this.shouldDelayReinit||(this.triggerCallback(this.settings.postclose,this.dom),this.triggerDelegateCall("didCloseEditInPlace"),this.markEditorAsInactive(),this.connectOpeningEvents())},setDefaultTextIfNeccessary:function(){""===this.dom.html()&&(this.dom.html(this.settings.default_text),this.didInsertDefaultText=!0)},connectOpeningEvents:function(){var t=this;this.dom.bind("mouseenter.editInPlace",function(){t.addHoverEffect()}).bind("mouseleave.editInPlace",function(){t.removeHoverEffect()}).bind("click.editInPlace",function(e){t.openEditor(e)})},disconnectOpeningEvents:function(){this.dom.unbind(".editInPlace")},addHoverEffect:function(){this.settings.hover_class?this.dom.addClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_over);var t=this.dom.attr("id");""!=t&&void 0!==t&&(t=t.replace("field_","")),jQuery("#arfmainfieldid_"+t+" .fieldname").css("background-color",this.settings.bg_over)},removeHoverEffect:function(){this.settings.hover_class?this.dom.removeClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_out),jQuery(".fieldname").css("background-color",this.settings.bg_out)},openEditor:function(t){this.shouldOpenEditor(t)&&(this.disconnectOpeningEvents(),this.removeHoverEffect(),this.removeInsertedDefaultTextIfNeccessary(),this.saveOriginalValue(),this.markEditorAsActive(),this.replaceContentWithEditor(),this.setInitialValue(),this.workAroundMissingBlurBug(),this.connectClosingEventsToEditor(),this.triggerDelegateCall("didOpenEditInPlace"))},shouldOpenEditor:function(t){return this.isClickedObjectCancelled(t.target)?!1:!1===this.triggerCallback(this.settings.preinit,this.dom)?!1:!1!==this.triggerDelegateCall("shouldOpenEditInPlace",!0,t)},removeInsertedDefaultTextIfNeccessary:function(){this.dom.html()===this.settings.default_text&&(this.dom.html(""),this.didInsertDefaultText=!1)},isClickedObjectCancelled:function(e){if(!this.settings.cancel)return!1;var i=t(e).parents().andSelf(),n=i.filter(this.settings.cancel);return 0!==n.length},saveOriginalValue:function(){this.settings.use_html?this.originalValue=this.dom.html():this.originalValue=s(this.dom.text())},restoreOriginalValue:function(){this.setClosedEditorContent(this.originalValue)},setClosedEditorContent:function(t){this.settings.use_html?""!=t?this.dom.html(t):this.dom.html(this.settings.default_text):""!=t?this.dom.text(t):this.dom.text(this.settings.default_text)},workAroundMissingBlurBug:function(){var t=this.dom.find(":input");this.dom.parents(":last").find(".editInPlace-active :input").not(t).blur()},replaceContentWithEditor:function(){var e=this.settings.show_buttons?this.settings.save_button+" "+this.settings.cancel_button:"",i=this.createEditorElement(),n=t('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;"></form>');this.dom.html(n),n.append(i).append(e)},createEditorElement:function(){if(-1===t.inArray(this.settings.field_type,["text","textarea","select"]))throw"Unknown field_type <fnord>, supported are 'text', 'textarea' and 'select'";var e=null;"select"===this.settings.field_type?e=this.createSelectEditor():"text"===this.settings.field_type?e=t('<input type="text" '+this.inputNameAndClass()+" />"):"textarea"===this.settings.field_type&&(e=t("<textarea "+this.inputNameAndClass()+' rows="'+this.settings.textarea_rows+'"  cols="'+this.settings.textarea_cols+'" />'));var i=this.dom.attr("class");if(i.indexOf("arfeditorformname")>=0&&(jQuery(".arfformeditpencil").hide(),jQuery(".arfformedit").css("width","98.7%")),i.indexOf("arfeditorformdescription")>=0&&(jQuery(".arfdescriptioneditpencil").hide(),jQuery(".arfdescriptionedit").css("width","98.7%")),i.indexOf("arfsubmitbtn")>=0){jQuery(".arfsubmiteditpencil").hide(),jQuery(".arfsubmitsettingpencil").hide();var n=jQuery(".arfsubmitedit .greensavebtn").width(),s=jQuery(".arfsubmitedit .greensavebtn").attr("data-auto");0==s&&(jQuery(".arfsubmitedit .greensavebtn").attr("data-width",n),jQuery(".arfsubmitedit .greensavebtn").css("width","auto"));var a=jQuery(".arfsubmitedit .greensavebtn").outerWidth();1==s&&(a=n),jQuery("#arfeditorsubmit").css("width",a+"px")}return e},setInitialValue:function(){var t=this.triggerDelegateCall("willOpenEditInPlace",this.originalValue),e=this.dom.find(":input");e.val(t),e.val()!==t&&e.val("")},inputNameAndClass:function(){return' name="inplace_value" class="inplace_field" '},createSelectEditor:function(){var e=t("<select"+this.inputNameAndClass()+'><option disabled="true" value="">'+this.settings.select_text+"</option></select>"),i=this.settings.select_options;t.isArray(i)||(i=i.split(","));for(var n=0;n<i.length;n++){var a=i[n];t.isArray(a)||(a=a.split(":"));var r=s(a[1]||a[0]),l=s(a[0]),o=t("<option>").val(r).text(l);e.append(o)}return e},connectClosingEventsToEditor:function(){function e(t){return n.handleCancelEditor(t),!1}function i(t){return n.handleSaveEditor(t),!1}var n=this,s=this.dom.find("form");s.find(".inplace_field").focus().select(),s.find(".inplace_cancel").click(e),s.find(".inplace_save").click(i),this.settings.show_buttons||("save"===this.settings.on_blur?s.find(".inplace_field").blur(i):s.find(".inplace_field").blur(e),(t.browser.mozilla||t.browser.msie)&&this.bindSubmitOnEnterInInput()),s.keyup(function(t){var n=27,s=13;return n===t.which?e():s===t.which?i():void 0}),t.browser.safari&&this.bindSubmitOnEnterInInput(),s.submit(i)},bindSubmitOnEnterInInput:function(){if("textarea"!==this.settings.field_type){var t=this;this.dom.find(":input").keyup(function(e){var i=13;return i===e.which?t.dom.find("form").submit():void 0})}},handleCancelEditor:function(t){if(!1!==this.triggerDelegateCall("shouldCloseEditInPlace",!0,t)){var e=this.dom.find(":input").val();e=this.triggerDelegateCall("willCloseEditInPlace",e);var i=this.dom.attr("class");if(i.indexOf("arfeditorformname")>=0&&(jQuery(".arfformeditpencil").show(),jQuery(".arfformedit").css("width","auto")),i.indexOf("arfeditorformdescription")>=0&&(jQuery(".arfdescriptioneditpencil").show(),jQuery(".arfdescriptionedit").css("width","auto")),i.indexOf("arfsubmitbtn")>=0){jQuery(".arfsubmiteditpencil").show(),jQuery(".arfsubmitsettingpencil").show();var n=jQuery(".arfsubmitedit .greensavebtn").attr("data-width"),s=jQuery(".arfsubmitedit .greensavebtn").attr("data-auto");1==s&&jQuery(".arfsubmitedit .greensavebtn").css("width",n+"px"),jQuery("#arfeditorsubmit").removeAttr("style"),arfsetsubmitautowdith()}this.restoreOriginalValue(),this.reinit()}},handleSaveEditor:function(t){if(!1!==this.triggerDelegateCall("shouldCloseEditInPlace",!0,t)){var e=this.dom.find(":input").val();e=this.triggerDelegateCall("willCloseEditInPlace",e);var i=this.dom.attr("id");""!=i&&void 0!==i&&(i=i.replace("field_","")),jQuery("#arfname_"+i).val(e),jQuery("#ar_op_lable_"+i).val(e),jQuery("#ar_op_value_"+i).val(e);var n=this.dom.attr("data-fid"),s=this.dom.attr("data-op-key");if(jQuery("#separate_value_"+n).is(":checked"))var a=jQuery("#ar_op_value_"+i).val();else var a=jQuery("#ar_op_lable_"+i).val();"undefined"!=typeof a&&(jQuery("#fieldcheck_"+n).val(a),jQuery("#arf_op_fieldcheck_sub_"+n+"-"+s).val(a),jQuery("#fieldcheck_"+n+"-"+s).val(a)),update_cl_field_menu(),arf_update_name_dropdown(),jQuery(".sltstandard select").selectpicker();var r=this.dom.attr("class");if(r.indexOf("arfsubmitbtn")>=0&&jQuery("#arfsubmitbuttontext").val(e),this.isDisabledDefaultSelectChoice()||this.isUnchangedInput(e)){this.handleCancelEditor(t);var r=this.dom.attr("class");if(r.indexOf("arfeditorformname")>=0&&(jQuery(".arfformeditpencil").show(),jQuery(".arfformedit").css("width","auto")),r.indexOf("arfeditorformdescription")>=0&&(jQuery(".arfdescriptioneditpencil").show(),jQuery(".arfdescriptionedit").css("width","auto")),r.indexOf("arfsubmitbtn")>=0){jQuery(".arfsubmiteditpencil").show(),jQuery(".arfsubmitsettingpencil").show();var l=jQuery(".arfsubmitedit .greensavebtn").attr("data-width"),o=jQuery(".arfsubmitedit .greensavebtn").attr("data-auto");1==o&&jQuery(".arfsubmitedit .greensavebtn").css("width",l+"px"),jQuery("#arfeditorsubmit").removeAttr("style"),arfsetsubmitautowdith()}}else{document.getElementById("required_form_title")?required_form_title=document.getElementById("required_form_title").value:required_form_title="Error: You must enter a value to save this field";var d=this.dom.attr("id");if(""!=d&&void 0!==d){d=d.replace("field_","");var u=jQuery("#field_type_"+d).val();if("divider"!=u){if(this.didForgetRequiredText(e))return this.handleCancelEditor(t),void this.reportError(required_form_title);var c=this.dom.attr("id");jQuery("#"+c).attr("data-original",this.originalValue)}}this.showSaving(e),this.settings.callback?this.handleSubmitToCallback(e):this.handleSubmitToServer(e)}}},didForgetRequiredText:function(t){return this.settings.value_required&&(""===t||void 0===t||null===t)},isDisabledDefaultSelectChoice:function(){return this.dom.find("option").eq(0).is(":selected:disabled")},isUnchangedInput:function(t){var e=this.dom.attr("class");return e.indexOf("arfoptioneditorfield")>=0||e.indexOf("arfeditorformname")>=0||e.indexOf("arfeditorformdescription")>=0||(this.originalValue=t),e.indexOf("arf_op_not_send_ajax")>=0&&(this.originalValue=t),!this.settings.save_if_nothing_changed&&this.originalValue===t},showSaving:function(e){if(!this.settings.callback||!this.settings.callback_skip_dom_reset){var i=e;a(this.settings.saving_text)&&(i=this.settings.saving_text),a(this.settings.saving_image)&&(i=t("<img />").attr("src",this.settings.saving_image).attr("alt",i)),this.dom.html(i)}},handleSubmitToCallback:function(t){this.enableOrDisableAnimationCallbacks(!0,!1);var e=this.triggerCallback(this.settings.callback,this.id(),t,this.originalValue,this.settings.params,this.savingAnimationCallbacks());this.settings.callback_skip_dom_reset||(void 0===e?(this.reportError("Error: Failed to save value: "+t),this.restoreOriginalValue()):this.dom.html(e)),this.didCallNoCallbacks()&&(this.enableOrDisableAnimationCallbacks(!1,!1),this.reinit())},handleSubmitToServer:function(e){var i=this.settings.update_value+"="+encodeURIComponent(e)+"&"+this.settings.element_id+"="+this.dom.attr("id")+(this.settings.params?"&"+this.settings.params:"")+"&"+this.settings.original_html+"="+encodeURIComponent(this.originalValue)+"&"+this.settings.original_value+"="+encodeURIComponent(this.originalValue);this.enableOrDisableAnimationCallbacks(!0,!1),this.didStartSaving();var n=this;t.ajax({url:n.settings.url,type:"POST",data:i,dataType:"html",complete:function(){n.didEndSaving()},success:function(t){var e=t||n.settings.default_text;n.dom.html(e),n.triggerCallback(n.settings.success,t)},error:function(t){n.dom.html(n.originalHTML),n.settings.error&&n.triggerCallback(n.settings.error,t)}})},triggerCallback:function(t){if(t){var e=Array.prototype.slice.call(arguments,1);return t.apply(this.dom[0],e)}},triggerDelegateCall:function(e,i,n){if(!this.settings.delegate||!t.isFunction(this.settings.delegate[e]))return i;var s=this.settings.delegate[e](this.dom,this.settings,n);return void 0===s?i:s},reportError:function(t){this.triggerCallback(this.settings.error_sink,this.id(),t)},id:function(){return this.dom.attr("id")},markEditorAsActive:function(){this.dom.addClass("editInPlace-active")},markEditorAsInactive:function(){this.dom.removeClass("editInPlace-active")},savingAnimationCallbacks:function(){var t=this;return{didStartSaving:function(){t.didStartSaving()},didEndSaving:function(){t.didEndSaving()}}},enableOrDisableAnimationCallbacks:function(t,e){this.didStartSaving.enabled=t,this.didEndSaving.enabled=e},didCallNoCallbacks:function(){return this.didStartSaving.enabled&&!this.didEndSaving.enabled},assertCanCall:function(t){if(!this[t].enabled)throw new Error("Cannot call "+t+" now. See documentation for details.")},didStartSaving:function(){this.assertCanCall("didStartSaving"),this.shouldDelayReinit=!0,this.enableOrDisableAnimationCallbacks(!1,!0),this.startSavingAnimation()},didEndSaving:function(){this.assertCanCall("didEndSaving"),this.shouldDelayReinit=!1,this.enableOrDisableAnimationCallbacks(!1,!1),this.reinit(),this.stopSavingAnimation()},startSavingAnimation:function(){var t=this;this.dom.animate({backgroundColor:this.settings.saving_animation_color},400).animate({backgroundColor:""},400,"swing",function(){setTimeout(function(){t.startSavingAnimation()},10)})},stopSavingAnimation:function(){this.dom.stop(!0).css({backgroundColor:""});var t=this.dom.attr("class");if(t.indexOf("arfeditorformname")>=0&&(jQuery(".arfformeditpencil").show(),jQuery(".arfformedit").css("width","auto")),t.indexOf("arfeditorformdescription")>=0&&(jQuery(".arfdescriptioneditpencil").show(),jQuery(".arfdescriptionedit").css("width","auto")),t.indexOf("arfsubmitbtn")>=0){jQuery(".arfsubmiteditpencil").show(),jQuery(".arfsubmitsettingpencil").show();var e=jQuery(".arfsubmitedit .greensavebtn").attr("data-width"),i=jQuery(".arfsubmitedit .greensavebtn").attr("data-auto");1==i&&jQuery(".arfsubmitedit .greensavebtn").css("width",e+"px"),jQuery("#arfeditorsubmit").removeAttr("style"),arfsetsubmitautowdith()}},missingCommaErrorPreventer:""})}(jQuery);